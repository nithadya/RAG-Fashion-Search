<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Same head content as products.html -->
    <title>My Wishlist - StyleMe</title>
</head>
<body>
    <!-- Same navbar as products.html -->

    <section class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4>My Wishlist</h4>
                <a href="products.html" class="btn btn-outline-primary">Continue Shopping</a>
            </div>
            
            <div class="row" id="wishlistProducts">
                <!-- Wishlist products will be loaded here -->
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading wishlist...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Same footer as products.html -->

    <script>
    $(document).ready(function() {
        checkAuthStatus();
        loadWishlistProducts();
        updateWishlistCount();
    });

    function loadWishlistProducts() {
        $.ajax({
            url: 'api/wishlist.php?action=list',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                const $container = $('#wishlistProducts');
                $container.empty();
                
                if (response.success && response.items && response.items.length > 0) {
                    response.items.forEach(product => {
                        const price = parseFloat(product.price) || 0;
                        const discountPrice = parseFloat(product.discount_price) || 0;
                        const hasDiscount = discountPrice > 0 && discountPrice < price;
                        const discountPercentage = hasDiscount 
                            ? Math.round(((price - discountPrice) / price) * 100)
                            : 0;
                        
                        $container.append(`
                            <div class="col-lg-3 col-md-4 col-6 mb-4">
                                <div class="card product-card h-100">
                                    ${hasDiscount ? `<span class="badge badge-sale">${discountPercentage}% OFF</span>` : ''}
                                    <a href="product-detail.html?id=${product.id}">
                                        <img src="assets/uploads/${product.image1}" 
                                             class="card-img-top product-img" 
                                             alt="${product.name}"
                                             onerror="this.src='assets/images/placeholder-product.jpg'">
                                    </a>
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <a href="product-detail.html?id=${product.id}" class="text-decoration-none text-dark">${product.name}</a>
                                        </h6>
                                        <div class="d-flex justify-content-between align-items-center mt-3">
                                            <div>
                                                ${hasDiscount 
                                                    ? `<span class="price">Rs. ${discountPrice.toFixed(2)}</span>
                                                       <small class="discount-price ms-2">Rs. ${price.toFixed(2)}</small>`
                                                    : `<span class="price">Rs. ${price.toFixed(2)}</span>`
                                                }
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger remove-wishlist" data-id="${product.id}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-primary w-100 mt-2 add-to-cart" data-id="${product.id}">
                                            <i class="fas fa-cart-plus me-2"></i> Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `);
                    });
                } else {
                    $container.html(`
                        <div class="col-12 text-center py-5">
                            <i class="far fa-heart fa-3x mb-3 text-muted"></i>
                            <h4>Your wishlist is empty</h4>
                            <p>Save your favorite items here for later</p>
                            <a href="products.html" class="btn btn-primary">Browse Products</a>
                        </div>
                    `);
                }
            },
            error: function() {
                $('#wishlistProducts').html(`
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
                        <h4>Error loading wishlist</h4>
                        <p>Please try again later</p>
                        <button class="btn btn-primary" onclick="loadWishlistProducts()">Retry</button>
                    </div>
                `);
            }
        });
    }

    // Include all the wishlist-related functions from products.html
    </script>
</body>
</html>